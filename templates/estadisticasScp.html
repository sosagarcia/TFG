<script>
  var fec;
  var muestras;
  var peri = document.getElementById("peri");
  peri.style.display = "none";
  var tipoD = document.getElementById("tipoD");
  var tipoDSelected;
  var periodo = document.getElementById("periodo");
  var periodoSelected;
  var fin = document.getElementById("fin");
  fin.style.display = "none";

  tipoD.addEventListener("change", function() {
    tipoDSelected = this.options[tipoD.selectedIndex];
  });

  periodo.addEventListener("change", function() {
    periodoSelected = this.options[periodo.selectedIndex];

    if (periodoSelected.value == "intervalo") {
      peri.style.display = "block";
    } else {
      peri.style.display = "none";
    }

    $(":checkbox")
      .checkboxpicker({
        onLabel: "Fecha Exacta",
        offLabel: "Hasta la actualidad"
      })
      .on("change", function() {
        if (fin.style.display == "none") {
          fin.style.display = "block";
        } else {
          fin.style.display = "none";
        }
      });
  });

  var timeFormat = "HH:mm:ss";
  function dameFecha(labels) {
    var fechas = [];

    for (var i = 0; i < labels.length; i++) {
      fechas[i] = newDateString(labels[i][0], labels[i][1], labels[i][2]);
    }
    return fechas;
  }
  function newDateString(hours, minutes, seconds) {
    return moment()
      .hour(hours)
      .minute(minutes)
      .second(seconds)
      .format(timeFormat);
  }
  function updateStatistics() {
    muestras = 50;
    fec = "17-08-2019";

    $.post("/updateStatistics", {
      tipo: tipoDSelected.value,
      fecha: fec,
      muestras: muestras
    }).done(function(reply) {
      actualiza(reply);
    });
  }

  function actualiza(results) {
    var color = Chart.helpers.color;
    var config = {
      type: "line",
      data: {
        labels: dameFecha(results.labels),
        datasets: [
          {
            label: results.legend,
            backgroundColor: color(window.chartColors.red)
              .alpha(0.5)
              .rgbString(),
            borderColor: window.chartColors.red,
            fill: false,
            data: results.data
          }
        ]
      },
      options: {
        title: {
          text: "Chart.js Time Scale"
        },
        scales: {
          xAxes: [
            {
              type: "time",
              time: {
                parser: timeFormat,
                // round: 'day'
                tooltipFormat: "ll HH:mm"
              },
              scaleLabel: {
                display: true,
                labelString: "Date"
              }
            }
          ],
          yAxes: [
            {
              scaleLabel: {
                display: true,
                labelString: "value"
              }
            }
          ]
        }
      }
    };
    var ctx = document.getElementById("canvas").getContext("2d");
    window.myLine = new Chart(ctx, config);
  });
  $("#act").on("click", updateStatistics);
</script>
