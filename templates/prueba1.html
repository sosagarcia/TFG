<html>
  <head>
    <title>Line Chart</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
    <script src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>
    <script src="https://www.chartjs.org/samples/latest/utils.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <div style="width:75%;">
      <button id="update">Update</button>
      <div class="ct-chart ct-perfect-fourth"></div>
      <canvas id="canvas"></canvas>
    </div>
    <br />
    <br />
    <script>
      var timeFormat = "HH:mm:ss";

      function dameFecha(labels) {
        var fechas = [];
        for (var i = 0; i < labels.length; i++) {
          fechas[i] = newDateString(labels[i][0], labels[i][1], labels[i][2]);
        }
        return fechas;
      }
      function newDateString(hours, minutes, seconds) {
        return moment()
          .hour(hours)
          .minute(minutes)
          .second(seconds)
          .format(timeFormat);
      }
      var getData = $.get("/dataD");
      var color = Chart.helpers.color;
      getData.done(function(results) {
        var config = {
          type: "line",
          data: {
            labels: dameFecha(results.legend),
            datasets: [
              {
                label: results.label,
                backgroundColor: color(window.chartColors.red)
                  .alpha(0.5)
                  .rgbString(),
                borderColor: window.chartColors.red,
                fill: false,
                data: results.results
              }
            ]
          },
          options: {
            title: {
              text: "Chart.js Time Scale"
            },
            scales: {
              xAxes: [
                {
                  type: "time",
                  time: {
                    parser: timeFormat,
                    // round: 'day'
                    tooltipFormat: "ll HH:mm"
                  },
                  scaleLabel: {
                    display: true,
                    labelString: "Date"
                  }
                }
              ],
              yAxes: [
                {
                  scaleLabel: {
                    display: true,
                    labelString: "value"
                  }
                }
              ]
            }
          }
        };
        var ctx = document.getElementById("canvas").getContext("2d");
        window.myLine = new Chart(ctx, config);
      });
    </script>
  </body>
</html>
