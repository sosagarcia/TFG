<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css"
    />
    <script src="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <button id="update">Update</button>
    <div class="ct-chart ct-perfect-fourth"></div>

    <script>
      var myChart;
      var getData = $.get("/dataD");
      var timeFormat = "HH:mm:ss";
      function newDateString(hours, minutes, seconds) {
        return moment()
          .hour(hours)
          .minute(minutes)
          .second(seconds)
          .format(timeFormat);
      }
      function dameFecha(labels) {
        var fechas = [];
        for (var i = 0; i < labels.length; i++) {
          fechas[i] = newDateString(labels[i][0], labels[i][1], labels[i][2]);
        }
        return fechas;
      }
      getData.done(function(results) {
        var data = {
          // A labels array that can contain any sort of values
          labels: dameFecha(results.labels),
          // Our series array that contains series objects or in this case series data arrays

          series: results.results
        };

        var options = {
          width: 800,
          height: 600,

          high: 100,
          // If low is specified then the axis will display values explicitly down to this value and the computed minimum from the data is ignored
          low: 0,
          // If specified then the value range determined from minimum to maximum (or low and high) will be divided by this number and ticks will be generated at those division points. The default divisor is 1.
          divisor: 4,
          // If ticks is explicitly set, then the axis will not compute the ticks with the divisor, but directly use the data in ticks to determine at what points on the axis a tick need to be generated.
          ticks: [1, 10, 20, 30]
        };

        myChart = new Chartist.Line(".ct-chart", data, options);
      });

      function updateChart() {
        var updateData = $.get("/dataD");
        updateData.done(function(results) {
          var data = {
            // A labels array that can contain any sort of values
            labels: dameFecha(results.labels),
            // Our series array that contains series objects or in this case series data arrays

            series: results.results
          };
          myChart.update(data);
        });
      }
      $("#update").on("click", updateChart);
    </script>
  </body>
</html>
